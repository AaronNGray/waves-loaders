function throwIfMissing(){throw new Error("Missing parameter")}var PRS$0=function(e,r){return e.__proto__={a:r},e.a===r}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(e,r){for(var t in r)r.hasOwnProperty(t)&&DP$0(e,t,GOPD$0(r,t));return e},SP$0=Object.setPrototypeOf||function(e,r){return PRS$0?e.__proto__=r:DP$0(e,"__proto__",{value:r,configurable:!0,enumerable:!1,writable:!0}),e},OC$0=Object.create,_=require("lodash"),events=require("events"),path=require("path"),audioContext=require("audio-context");require("native-promise-only");var Loader=function(e){"use strict";function r(){var r=arguments[0];void 0===r&&(r=""),e.call(this),this.responseType=r,this.progressCb=void 0}function t(){return this.progressCb}function o(e){this.progressCb=e}PRS$0||MIXIN$0(r,e);var n={};return null!==e&&SP$0(r,e),r.prototype=OC$0(null!==e?e.prototype:null,{constructor:{value:r,configurable:!0,writable:!0},progressCallback:{get:t,set:o,configurable:!0,enumerable:!0}}),DP$0(r,"prototype",{configurable:!1,enumerable:!1,writable:!1}),n.load=function(){var e=arguments[0];if(void 0===e&&(e=throwIfMissing()),void 0===e)throw new Error("load needs at least a url to load");return Array.isArray(e)?this.loadAll(e):this.loadOne(e)},n.loadOne=function(e){return this.fileLoadingRequest(e)},n.loadAll=function(e){for(var r=e.length,t=[],o=0;r>o;++o)t.push(this.fileLoadingRequest(e[o],o));return Promise.all(t)},n.fileLoadingRequest=function(e,r){var t=this,o=new Promise(function(o,n){var a=new XMLHttpRequest;a.open("GET",e,!0),a.index=r,t.emit("xmlhttprequest",a),a.responseType=t.responseType,a.addEventListener("load",function(){200===a.status||304===a.status?("json"===this.responseType&&"string"==typeof a.response&&(a.response=JSON.parse(a.response)),o(a.response)):n(new Error(a.statusText))}),a.addEventListener("progress",function(e){t.progressCallback&&t.progressCallback(void 0!==r?{index:r,value:e.loaded/e.total,loaded:e.loaded,total:e.total}:{value:e.loaded/e.total,loaded:e.loaded,total:e.total})}),a.addEventListener("error",function(){n(new Error("Network Error"))}),a.send()});return o},MIXIN$0(r.prototype,n),n=void 0,r}(events.EventEmitter),AudioBufferLoader=function(e){"use strict";function r(){this.options={wrapAroundExtension:0},this.responseType="arraybuffer",e.call(this,this.responseType)}PRS$0||MIXIN$0(r,e);var t={};return null!==e&&SP$0(r,e),r.prototype=OC$0(null!==e?e.prototype:null,{constructor:{value:r,configurable:!0,writable:!0}}),DP$0(r,"prototype",{configurable:!1,enumerable:!1,writable:!1}),t.load=function(){var r=arguments[0];void 0===r&&(r=throwIfMissing());var t=arguments[1];return void 0===t&&(t={}),this.options=t,this.options.wrapAroundExtension=this.options.wrapAroundExtension||0,e.prototype.load.call(this,r)},t.loadOne=function(r){return e.prototype.loadOne.call(this,r).then(this.decodeAudioData.bind(this),function(e){throw e})},t.loadAll=function(r){var t=this;return e.prototype.loadAll.call(this,r).then(function(e){return Promise.all(e.map(function(e){return t.decodeAudioData.bind(t)(e)}))},function(e){throw e})},t.decodeAudioData=function(e){var r=this;return new Promise(function(t,o){audioContext.decodeAudioData(e,function(e){t(0===r.options.wrapAroundExtension?e:r.__wrapAround(e))},function(){o(new Error("DecodeAudioData error"))})})},t.__wrapAround=function(e){for(var r,t,o=e.length+this.options.wrapAroundExtension*e.sampleRate,n=audioContext.createBuffer(e.numberOfChannels,o,e.sampleRate),a=0;a<e.numberOfChannels;a++)r=e.getChannelData(a),t=n.getChannelData(a),_.forEach(t,function(o,n){t[n]=n<e.length?r[n]:r[n-e.length]});return n},MIXIN$0(r.prototype,t),t=void 0,r}(Loader),SuperLoader=function(){"use strict";function e(){this.bufferLoader=new AudioBufferLoader,this.loader=new Loader("json")}var r={};return DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),r.load=function(){var e=arguments[0];void 0===e&&(e=throwIfMissing());var r=arguments[1];if(void 0===r&&(r={}),this.options=r,this.options.wrapAroundExtension=this.options.wrapAroundExtension||0,Array.isArray(e)){var t=-1,o=[[],[]],n=_.filter(e,function(e){var r=path.extname(e);return t+=1,".json"==r?(o[0].push(t),!0):(o[1].push(t),!1)}),a=_.difference(e,n),i=[];return n.length>0&&i.push(this.loader.load(n)),a.length>0&&i.push(this.bufferLoader.load(a,this.options)),new Promise(function(e){Promise.all(i).then(function(r){if(1===r.length)e(r[0]);else{for(var t=[],n=0;n<o.length;n++)for(var a=0;a<o[n].length;a++)t[o[n][a]]=r[n][a];e(t)}},function(e){throw e})})}},MIXIN$0(e.prototype,r),r=void 0,e}();module.exports={Loader:Loader,AudioBufferLoader:AudioBufferLoader,SuperLoader:SuperLoader};
